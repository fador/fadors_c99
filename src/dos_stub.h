#ifndef DOS_STUB_H
#define DOS_STUB_H

#include <stdint.h>

/* 
 * Minimal MS-DOS Stub (16-bit)
 * Displays "This program cannot be run in DOS mode." and exits.
 * Total size: 64 bytes header + ~40 bytes code
 */

static const unsigned char dos_stub[] = {
    /* MZ Header */
    0x4D, 0x5A,             /* MZ signature */
    0x90, 0x00,             /* Bytes on last page of file */
    0x03, 0x00,             /* Pages in file */
    0x00, 0x00,             /* Relocations */
    0x04, 0x00,             /* Size of header in paragraphs */
    0x00, 0x00,             /* Min extra paragraphs needed */
    0xFF, 0xFF,             /* Max extra paragraphs needed */
    0x00, 0x00,             /* Initial (relative) SS */
    0xB8, 0x00,             /* Initial SP */
    0x00, 0x00,             /* Checksum */
    0x00, 0x00,             /* Initial IP */
    0x00, 0x00,             /* Initial (relative) CS */
    0x40, 0x00,             /* File address of relocation table */
    0x00, 0x00,             /* Overlay number */
    /* Reserved words */
    0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00,

    /* Reserved words (OEM) */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 
    
    /* Offset of PE header (if PE) or just code starts here */
    0x80, 0x00, 0x00, 0x00, /* e_lfanew: offset to new header (if valid PE) or just data */

    /* DOS Stub Code (starts at 0x40 if header size 4 paras = 64 bytes) */
    /* PUSH CS; POP DS; DX=0x0E; AH=0x09; INT 0x21; AX=0x4C01; INT 0x21 */
    0x0E,                   /* PUSH CS */
    0x1F,                   /* POP DS */
    0xBA, 0x0E, 0x00,       /* MOV DX, 000E (offset of string) */
    0xB4, 0x09,             /* MOV AH, 09 */
    0xCD, 0x21,             /* INT 21 */
    0xB8, 0x01, 0x4C,       /* MOV AX, 4C01 */
    0xCD, 0x21,             /* INT 21 */

    /* Message: "This program cannot be run in DOS mode.$" */
    0x54, 0x68, 0x69, 0x73, 0x20, 0x70, 0x72, 0x6F, 0x67, 0x72, 0x61, 0x6D, 0x20, 
    0x63, 0x61, 0x6E, 0x6E, 0x6F, 0x74, 0x20, 0x62, 0x65, 0x20, 0x72, 0x75, 0x6E, 
    0x20, 0x69, 0x6E, 0x20, 0x44, 0x4F, 0x53, 0x20, 0x6D, 0x6F, 0x64, 0x65, 0x2E, 
    0x0D, 0x0D, 0x0A, 0x24, 0x00, 0x00, 0x00, 0x00
};

#endif
